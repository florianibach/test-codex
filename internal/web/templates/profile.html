{{define "profile_content"}}
<section class="card shadow-sm">
  <div class="card-body">
    <h1 class="h3 mb-1">Profile settings</h1>
    <p class="text-secondary small mb-3">Usually configured once, available anytime.</p>
    <a class="btn btn-sm btn-outline-secondary mb-3" href="/switch-profile">Switch profile</a>

    {{if .ProfileError}}
    <div class="alert alert-danger py-2" role="alert">{{.ProfileError}}</div>
    {{end}}
    {{if .ProfileFeedback}}
    <div class="alert alert-success py-2" role="status">{{.ProfileFeedback}}</div>
    {{end}}

    <form id="profile-edit-form" method="post" action="/settings/profile" class="vstack gap-3">
      <div>
        <label for="profile_name" class="form-label">Profile name</label>
        <input id="profile_name" name="profile_name" type="text" class="form-control" value="{{.ProfileName}}" required />
      </div>

      <div class="form-section">
        <p class="section-heading mb-2">Defaults</p>
        <div class="vstack gap-3">
          <div>
            <label for="hourly_wage" class="form-label">Net hourly wage</label>
            <p class="form-text mb-1">Currency symbol/code for all money fields (default: €).</p>
            <input id="hourly_wage" name="hourly_wage" type="number" min="0.01" step="0.01" inputmode="decimal" class="form-control" placeholder="e.g. 25" value="{{.ProfileHourly}}" required />
          </div>
          <div>
            <label for="currency" class="form-label">Currency</label>
            <input id="currency" name="currency" type="text" class="form-control" placeholder="€, CHF, $, EUR" value="{{.Currency}}" />
          </div>
          <div>
            <label for="default_wait_preset" class="form-label">Default wait time</label>
            <select id="default_wait_preset" name="default_wait_preset" class="form-select">
              <option value="24h" {{if or (eq .DefaultWaitPreset "") (eq .DefaultWaitPreset "24h")}}selected{{end}}>24h</option>
              <option value="7d" {{if eq .DefaultWaitPreset "7d"}}selected{{end}}>7 days</option>
              <option value="30d" {{if eq .DefaultWaitPreset "30d"}}selected{{end}}>30 days</option>
              <option value="custom" {{if eq .DefaultWaitPreset "custom"}}selected{{end}}>Custom</option>
            </select>
          </div>
          <div id="default-custom-hours-group" {{if ne .DefaultWaitPreset "custom"}}hidden{{end}}>
            <label for="default_wait_custom_hours" class="form-label">Default custom hours</label>
            <input id="default_wait_custom_hours" name="default_wait_custom_hours" type="number" min="0.0001" step="any" class="form-control" placeholder="e.g. 12" value="{{.DefaultWaitCustomHours}}" {{if ne .DefaultWaitPreset "custom"}}disabled{{end}} />
          </div>
        </div>
      </div>

      <div class="form-section">
        <p class="section-heading mb-2">Notifications (optional)</p>
        <div class="vstack gap-3">
          <div>
            <label for="ntfy_endpoint" class="form-label">ntfy endpoint</label>
            <input id="ntfy_endpoint" name="ntfy_endpoint" type="url" class="form-control" placeholder="https://ntfy.sh" value="{{.NtfyEndpoint}}" />
          </div>
          <div>
            <label for="ntfy_topic" class="form-label">ntfy topic</label>
            <input id="ntfy_topic" name="ntfy_topic" type="text" class="form-control" placeholder="impulse-pause" value="{{.NtfyTopic}}" />
          </div>
        </div>
      </div>

      <button id="profile-save-btn" class="btn btn-outline-primary" type="submit">Save profile</button>
    </form>
  </div>
</section>
{{end}}

{{define "profile_script"}}
<script>
  (function () {
    var preset = document.getElementById("default_wait_preset");
    var group = document.getElementById("default-custom-hours-group");
    var input = document.getElementById("default_wait_custom_hours");

    function sync() {
      if (!preset || !group || !input) {
        return;
      }
      var isCustom = preset.value === "custom";
      group.hidden = !isCustom;
      input.disabled = !isCustom;
    }

    if (preset) {
      preset.addEventListener("change", sync);
    }
    sync();
  })();
</script>
{{end}}
