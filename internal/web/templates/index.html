<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{.Title}}</title>
  <link href="/assets/app.css" rel="stylesheet">
</head>
<body class="bg-body-tertiary">
  <main class="container py-3 py-md-4" style="max-width: 720px;">
    <header class="d-flex justify-content-between align-items-center mb-3 page-header title-bar">
      <div>
        <p class="title-eyebrow mb-1">Impulse control dashboard</p>
        <h1 class="h3 mb-1 title-heading">Impulse Pause</h1>
        <p class="title-subline mb-0">Review your waitlist first, add only when needed.</p>
      </div>
      <nav class="d-flex gap-2 wrap-sm" aria-label="Primary">
        <a class="btn btn-light btn-sm" href="/settings/profile">Settings</a>
        <a class="btn btn-outline-light btn-sm" href="/about">About</a>
      </nav>
    </header>

    <section class="card shadow-sm mb-4">
      <div class="card-body d-flex justify-content-between align-items-center gap-3 wrap-sm">
        <div>
          <h2 class="h5 card-title mb-1">Waitlist dashboard</h2>
          <p class="text-secondary small mb-0">Your primary place for decisions.</p>
        </div>
        <div class="d-flex gap-2 wrap-sm">
          <a class="btn btn-primary" href="/items/new">Add item</a>
        </div>
      </div>
    </section>

    <section class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h5 mb-0">Waitlist</h2>
          <span class="badge text-bg-secondary">{{len .Items}} items</span>
        </div>

        {{if not .Items}}
        <p class="text-secondary mb-0">No entries yet. Add your first item when needed.</p>
        {{else}}
        <ul class="list-group list-group-flush">
          {{range .Items}}
          <li class="list-group-item px-0">
            <div class="d-flex justify-content-between align-items-start gap-3 wrap-sm">
              <div>
                <p class="fw-semibold mb-1">{{.Title}}</p>
                {{if .Note}}<p class="small text-secondary mb-1">{{.Note}}</p>{{end}}
                {{if .Tags}}<p class="small text-secondary mb-1">Tags: {{.Tags}}</p>{{end}}
                {{if .Link}}<a class="small" href="{{.Link}}" target="_blank" rel="noreferrer">Open link</a>{{end}}
              </div>
              <div class="text-end">
                <span class="badge {{statusBadgeClass .Status}}">{{.Status}}</span>
                {{if .Price}}<p class="small text-secondary mb-0 mt-1">{{.Price}}</p>{{end}}
                <p class="small text-secondary mb-0 mt-1">
                  Buy after:
                  <time class="purchase-allowed-at" datetime="{{.PurchaseAllowedAt.UTC.Format "2006-01-02T15:04:05Z07:00"}}">{{.PurchaseAllowedAt.Format "02.01.2006 15:04"}}</time>
                </p>
                {{if eq .Status "Ready to buy"}}
                <form method="post" action="/items/status" class="d-flex flex-column gap-1 mt-2">
                  <input type="hidden" name="item_id" value="{{.ID}}" />
                  <button class="btn btn-sm btn-success" type="submit" name="status" value="Bought">Mark as bought</button>
                  <button class="btn btn-sm btn-outline-secondary" type="submit" name="status" value="Skipped">Mark as skipped</button>
                </form>
                {{end}}
              </div>
            </div>
          </li>
          {{end}}
        </ul>
        {{end}}
      </div>
    </section>
  </main>

  <script>
    (function () {
      var formatter = new Intl.DateTimeFormat(navigator.language, {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit"
      });

      document.querySelectorAll(".purchase-allowed-at").forEach(function (node) {
        var raw = node.getAttribute("datetime");
        if (!raw) {
          return;
        }

        var parsed = new Date(raw);
        if (Number.isNaN(parsed.getTime())) {
          return;
        }

        node.textContent = formatter.format(parsed);
      });
    })();
  </script>
</body>
</html>
