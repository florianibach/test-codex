{{define "items_new_content"}}
<section class="card shadow-sm mb-4">
  <div class="card-body">
    <h1 class="h3 mb-1">{{.Title}}</h1>
    <p class="text-secondary mb-3">Capture quickly now, enrich details later.</p>

    {{if .Error}}
    <div class="alert alert-danger py-2" role="alert">{{.Error}}</div>
    {{end}}

    <form method="post" action="{{.FormAction}}" class="vstack gap-3">
      <div class="form-section">
        <p class="section-heading mb-2">Core decision</p>
        <div class="vstack gap-3">
          <div>
            <label for="title" class="form-label">Title <span class="text-danger">*</span></label>
            <input id="title" name="title" class="form-control form-control-lg" autocomplete="off" required placeholder="e.g. New headphones" value="{{.FormValues.Title}}" />
          </div>

          <div>
            <label for="wait_preset" class="form-label">Wait time</label>
            <select id="wait_preset" name="wait_preset" class="form-select">
              <option value="24h" {{if or (eq .FormValues.WaitPreset "") (eq .FormValues.WaitPreset "24h")}}selected{{end}}>24h</option>
              <option value="7d" {{if eq .FormValues.WaitPreset "7d"}}selected{{end}}>7 days</option>
              <option value="30d" {{if eq .FormValues.WaitPreset "30d"}}selected{{end}}>30 days</option>
              <option value="custom" {{if eq .FormValues.WaitPreset "custom"}}selected{{end}}>Custom</option>
              <option value="date" {{if eq .FormValues.WaitPreset "date"}}selected{{end}}>Specific date & time</option>
            </select>
          </div>

          <input id="timezone_offset_minutes" name="timezone_offset_minutes" type="hidden" />

          <div id="custom-hours-group" {{if ne .FormValues.WaitPreset "custom"}}hidden{{end}}>
            <label for="wait_custom_hours" class="form-label">Custom hours</label>
            <input id="wait_custom_hours" name="wait_custom_hours" type="number" min="0.0001" step="any" class="form-control" placeholder="e.g. 12" value="{{.FormValues.WaitCustomHours}}" {{if ne .FormValues.WaitPreset "custom"}}disabled{{end}} />
          </div>
          <div id="purchase-allowed-group" {{if ne .FormValues.WaitPreset "date"}}hidden{{end}}>
            <label for="purchase_allowed_at" class="form-label">Buy after</label>
            <input id="purchase_allowed_at" name="purchase_allowed_at" type="datetime-local" class="form-control" value="{{.PurchaseAllowedInput}}" {{if ne .FormValues.WaitPreset "date"}}disabled{{end}} />
          </div>
        </div>
      </div>

      <div class="form-section">
        <p class="section-heading mb-2">Optional details</p>
        <div class="vstack gap-3">
          <div>
            <label for="price" class="form-label">Price</label>
            <input id="price" name="price" class="form-control" placeholder="e.g. 129.99" value="{{.FormValues.Price}}" />
          </div>
          <div>
            <label for="link" class="form-label">Link</label>
            <input id="link" name="link" class="form-control" placeholder="https://..." value="{{.FormValues.Link}}" />
          </div>
          <div>
            <label for="tags" class="form-label">Tags</label>
            <input id="tags" name="tags" class="form-control" placeholder="Tech, Audio" value="{{.FormValues.Tags}}" />
          </div>
          <div>
            <label for="note" class="form-label">Note</label>
            <textarea id="note" name="note" class="form-control" rows="2" placeholder="Why do you want to buy this?">{{.FormValues.Note}}</textarea>
          </div>
        </div>
      </div>

      <div class="d-flex gap-2 wrap-sm">
        <button class="btn btn-primary btn-lg" type="submit">{{.SubmitLabel}}</button>
        <a class="btn btn-outline-secondary btn-lg" href="{{.CancelHref}}">Cancel</a>
      </div>
    </form>
  </div>
</section>
{{end}}

{{define "items_new_script"}}
<script>
  (function () {
    var waitPreset = document.getElementById("wait_preset");
    var customHoursGroup = document.getElementById("custom-hours-group");
    var customHoursInput = document.getElementById("wait_custom_hours");
    var purchaseAllowedGroup = document.getElementById("purchase-allowed-group");
    var purchaseAllowedInput = document.getElementById("purchase_allowed_at");
    var timezoneOffsetInput = document.getElementById("timezone_offset_minutes");

    function syncWaitInputVisibility() {
      if (!waitPreset || !customHoursGroup || !customHoursInput || !purchaseAllowedGroup || !purchaseAllowedInput) {
        return;
      }

      var isCustom = waitPreset.value === "custom";
      var isDate = waitPreset.value === "date";

      customHoursGroup.hidden = !isCustom;
      customHoursInput.disabled = !isCustom;

      purchaseAllowedGroup.hidden = !isDate;
      purchaseAllowedInput.disabled = !isDate;
    }

    function syncTimezoneOffset() {
      if (!timezoneOffsetInput) {
        return;
      }
      timezoneOffsetInput.value = String(new Date().getTimezoneOffset());
    }

    if (waitPreset) {
      waitPreset.addEventListener("change", syncWaitInputVisibility);
    }
    syncTimezoneOffset();
    syncWaitInputVisibility();
  })();
</script>
{{end}}
